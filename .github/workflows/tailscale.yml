on:
  workflow_dispatch:
  push:

jobs:
  deploy-via-tailscale:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Tailscale
      uses: tailscale/github-action@v2
      with:
        authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
    - name: Test Conn
      run: |
        ping -c 5 172.20.0.16
        echo "check chef infra conn"
        nc -zv 172.20.0.212 443
        nslookup chat-svc.priv.dev.workstream.is
        sleep 60